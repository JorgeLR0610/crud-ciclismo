<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Lista de Ciclistas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/styles.css}" rel="stylesheet">
</head>

<body>

    <div class="container">
        <h1>Ciclistas</h1>

        <div th:if="${mensaje}" th:class="'alert alert-' + ${tipo} + ' alert-dismissible fade show'" role="alert">
            <span th:text="${mensaje}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div class="d-flex mb-3 animate-fade-in-up">
            <a th:href="@{/ciclistas/nuevo}" class="btn btn-primary">Añadir Nuevo Ciclista</a>
            <a th:href="@{/}" class="btn btn-outline-secondary ms-auto">Volver al menú principal</a>
        </div>

        <!-- Real-time Search Integrated -->
        <form th:action="@{/ciclistas}" method="get"
            class="d-flex align-items-center mb-3 p-3 bg-light rounded animate-fade-in-up delay-100">

            <label for="campo" class="form-label me-2 mb-0">Buscar por:</label>

            <select name="campo" id="searchSelect" class="form-select me-2" style="width: 200px;">
                <option value="nombre" data-col-index="1">Nombre</option>
                <option value="ap" data-col-index="2">Apellido Paterno</option>
                <option value="am" data-col-index="3">Apellido Materno</option>
                <option value="dorsal" data-col-index="0">Dorsal</option>
                <option value="edad" data-col-index="4">Edad</option>
            </select>

            <input type="text" name="query" id="searchInput" class="form-control me-2"
                placeholder="Escribe tu búsqueda..." />

            <button type="submit" class="btn btn-secondary me-2">Buscar</button>

            <a th:href="@{/ciclistas}" class="btn btn-light">Limpiar</a>

        </form>

        <table class="table table-hover animate-fade-in-up delay-300">
            <thead class="table-dark">
                <tr>
                    <th>Dorsal</th>
                    <th>Nombre</th>
                    <th>Apellido Paterno</th>
                    <th>Apellido Materno</th>
                    <th>Edad</th>
                    <th>Equipo</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="ciclista : ${listaDeCiclistas}">
                    <td th:text="${ciclista.dorsal}">1</td>
                    <td th:text="${ciclista.nombre}">Nombre</td>
                    <td th:text="${ciclista.ap}">Apellido Paterno</td>
                    <td th:text="${ciclista.am}">Apellido Materno</td>
                    <td th:text="${ciclista.edad}">Edad</td>
                    <td th:text="${ciclista.noEquipo?.nombreEquipo}">Equipo</td>
                    <td>
                        <a th:href="@{/ciclistas/editar/{id}(id=${ciclista.dorsal})}" class="btn btn-warning btn-sm">
                            Editar
                        </a>
                        <form th:action="@{/ciclistas/eliminar/{id}(id=${ciclista.dorsal})}" method="post"
                            style="display:inline;">
                            <input type="hidden" name="_method" value="DELETE" />
                            <button type="submit" class="btn btn-danger btn-sm"
                                onclick="return confirm('¿Estás seguro de eliminar este ciclista?')">
                                Eliminar
                            </button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/scripts.js}"></script>
</body>

</html>